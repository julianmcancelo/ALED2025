<!-- 
  TEMPLATE SIMPLIFICADO DE PERSONALIZACIÓN DE TARJETAS VIRTUALES
  Usando Bootstrap en lugar de Angular Material para evitar dependencias
-->

<div class="container mt-4">
  
  <!-- Encabezado -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex align-items-center mb-3">
        <i class="bi bi-credit-card-fill fs-2 text-primary me-3"></i>
        <div>
          <h2 class="mb-1">Personalización de Tarjetas Virtuales</h2>
          <p class="text-muted mb-0">Configura la apariencia y detalles de las tarjetas virtuales del sistema</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Estado de carga -->
  <div *ngIf="estaCargando()" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-3 text-muted">Cargando configuración...</p>
  </div>

  <!-- Contenido principal -->
  <div *ngIf="!estaCargando()" class="row">
    
    <!-- Panel de configuración -->
    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">
            <i class="bi bi-gear-fill me-2"></i>
            Configuración
          </h5>
        </div>
        <div class="card-body">
          
          <form [formGroup]="formularioPersonalizacion" *ngIf="formularioPersonalizacion">
            
            <!-- Tipo de tarjeta -->
            <div class="mb-3">
              <label for="tipoTarjeta" class="form-label">Tipo de Tarjeta</label>
              <select class="form-select" id="tipoTarjeta" formControlName="tipoTarjetaDefault">
                <option value="">Seleccionar tipo...</option>
                <option *ngFor="let tipo of tiposTarjeta" [value]="tipo">{{ tipo }}</option>
              </select>
            </div>

            <!-- Nombre del banco -->
            <div class="mb-3">
              <label for="nombreBanco" class="form-label">Nombre del Banco</label>
              <input type="text" class="form-control" id="nombreBanco" 
                     formControlName="nombreBanco" placeholder="Ej: Banco Virtual">
              <div class="form-text">Máximo 50 caracteres</div>
            </div>

            <!-- Prefijo del número -->
            <div class="mb-3">
              <label for="prefijoNumero" class="form-label">Prefijo del Número</label>
              <input type="text" class="form-control" id="prefijoNumero" 
                     formControlName="prefijoNumero" placeholder="4532" maxlength="4">
              <div class="form-text">1-4 dígitos que identifican el tipo de tarjeta</div>
            </div>

            <!-- Colores -->
            <div class="mb-3">
              <h6>Colores de la Tarjeta</h6>
              <div class="row">
                <div class="col-6">
                  <label for="colorPrimario" class="form-label">Color Primario</label>
                  <input type="color" class="form-control form-control-color" 
                         id="colorPrimario" formControlName="colorPrimario">
                </div>
                <div class="col-6">
                  <label for="colorSecundario" class="form-label">Color Secundario</label>
                  <input type="color" class="form-control form-control-color" 
                         id="colorSecundario" formControlName="colorSecundario">
                </div>
              </div>
            </div>

            <!-- Logo -->
            <div class="mb-3">
              <h6>Logo del Banco/Tarjeta</h6>
              
              <!-- Logo actual -->
              <div *ngIf="logoActual()" class="mb-3">
                <img [src]="logoActual()" alt="Logo actual" class="img-thumbnail" style="max-width: 150px; max-height: 80px;">
                <button type="button" class="btn btn-sm btn-outline-danger ms-2" (click)="eliminarLogo()">
                  <i class="bi bi-trash"></i> Eliminar
                </button>
              </div>

              <!-- Sin logo -->
              <div *ngIf="!logoActual()" class="text-center py-3 border border-dashed rounded">
                <i class="bi bi-image fs-1 text-muted"></i>
                <p class="text-muted">Sin logo personalizado</p>
              </div>

              <!-- Subir logo -->
              <div class="mt-3">
                <input type="file" #fileInput (change)="onLogoSeleccionado($event)" 
                       accept="image/*" style="display: none">
                <button type="button" class="btn btn-outline-primary" (click)="fileInput.click()">
                  <i class="bi bi-upload"></i> Subir Logo
                </button>
                <div class="form-text">Formatos: JPEG, PNG, GIF, WebP. Máximo 2MB.</div>
              </div>
            </div>

            <!-- Botones de acción -->
            <div class="d-flex justify-content-between">
              <button type="button" class="btn btn-outline-secondary" 
                      (click)="restaurarDefecto()" [disabled]="estaGuardando()">
                <i class="bi bi-arrow-clockwise"></i> Restaurar Defecto
              </button>
              <button type="button" class="btn btn-primary" 
                      (click)="guardarConfiguracion()" 
                      [disabled]="!formularioPersonalizacion.valid || estaGuardando()">
                <span *ngIf="estaGuardando()" class="spinner-border spinner-border-sm me-2"></span>
                <i *ngIf="!estaGuardando()" class="bi bi-check-lg me-1"></i>
                {{ estaGuardando() ? 'Guardando...' : 'Guardar Cambios' }}
              </button>
            </div>

          </form>

        </div>
      </div>
    </div>

    <!-- Vista previa -->
    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0">
            <i class="bi bi-eye-fill me-2"></i>
            Vista Previa
          </h5>
        </div>
        <div class="card-body">
          
          <!-- Tarjeta de ejemplo -->
          <div class="tarjeta-ejemplo mx-auto mb-4" [ngStyle]="getEstiloTarjetaPreview()">
            
            <!-- Header de la tarjeta -->
            <div class="d-flex justify-content-between align-items-start mb-3">
              <div class="logo-container">
                <img *ngIf="logoActual()" [src]="logoActual()" alt="Logo" 
                     style="max-width: 60px; max-height: 30px; filter: brightness(0) invert(1);">
                <div *ngIf="!logoActual()" class="bg-white bg-opacity-25 rounded-circle d-flex align-items-center justify-content-center" 
                     style="width: 40px; height: 40px;">
                  <i class="bi bi-bank text-white"></i>
                </div>
              </div>
              <div class="tipo-tarjeta text-white fw-bold" style="font-size: 14px; letter-spacing: 2px;">
                {{ formularioPersonalizacion.get('tipoTarjetaDefault')?.value || 'VISA' }}
              </div>
            </div>

            <!-- Número de tarjeta -->
            <div class="numero-tarjeta text-white text-center mb-3" 
                 style="font-family: 'Courier New', monospace; font-size: 18px; letter-spacing: 3px;">
              {{ getNumeroEjemplo() }}
            </div>

            <!-- Información del titular -->
            <div class="d-flex justify-content-between align-items-end">
              <div>
                <div style="font-size: 10px; color: rgba(255,255,255,0.8); letter-spacing: 1px;">TITULAR</div>
                <div class="text-white" style="font-size: 14px; font-weight: 500;">USUARIO EJEMPLO</div>
              </div>
              <div>
                <div style="font-size: 10px; color: rgba(255,255,255,0.8); letter-spacing: 1px;">VENCE</div>
                <div class="text-white" style="font-size: 14px; font-weight: 500;">12/29</div>
              </div>
            </div>

            <!-- Nombre del banco -->
            <div class="position-absolute bottom-0 end-0 p-3">
              <div class="text-white" style="font-size: 12px; font-weight: 600; letter-spacing: 1px; opacity: 0.9;">
                {{ formularioPersonalizacion.get('nombreBanco')?.value || 'BANCO VIRTUAL' }}
              </div>
            </div>

          </div>

          <!-- Información adicional -->
          <div class="alert alert-warning">
            <i class="bi bi-exclamation-triangle me-2"></i>
            <strong>Importante:</strong> Los cambios se aplicarán a <strong>TODAS las tarjetas virtuales existentes</strong> y a las nuevas tarjetas que se creen.
          </div>

        </div>
      </div>
    </div>

  </div>

  <!-- Información adicional -->
  <div class="row mt-4" *ngIf="!estaCargando()">
    <div class="col-12">
      <div class="alert alert-warning">
        <i class="bi bi-lightbulb me-2"></i>
        <strong>Consejos de Personalización:</strong>
        <ul class="mb-0 mt-2">
          <li><strong>Logo:</strong> Use imágenes con fondo transparente para mejor resultado</li>
          <li><strong>Colores:</strong> Elija colores con buen contraste para legibilidad</li>
          <li><strong>Prefijo:</strong> Cada tipo de tarjeta tiene prefijos específicos (Visa: 4, Mastercard: 5)</li>
          <li><strong>Banco:</strong> Use nombres cortos para mejor visualización en la tarjeta</li>
        </ul>
      </div>
    </div>
  </div>

</div>

<style>
.tarjeta-ejemplo {
  width: 350px;
  height: 220px;
  border-radius: 16px;
  padding: 20px;
  position: relative;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
  background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
}

.form-control-color {
  width: 100%;
  height: 40px;
}

.logo-container {
  width: 60px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
}
</style>
