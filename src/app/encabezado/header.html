<!-- Header estilo Mercado Libre con colores personalizados -->
<header class="header-ml">
  <!-- Barra Superior (amarilla/azul) -->
  <div class="header-top">
    <div class="container-fluid">
      <div class="row align-items-center py-2">
        <!-- Logo -->
        <div class="col-auto">
          <a class="logo-link" routerLink="/">
            <i class="bi bi-gem me-2"></i>
            <span class="logo-text">{{ configuracion().titulo || 'ALED' }}</span>
          </a>
        </div>

        <!-- Barra de Búsqueda Prominente -->
        <div class="col">
          <div class="search-bar-container">
            <input 
              type="text" 
              placeholder="Buscar productos, marcas y más..." 
              class="search-input"
              #searchInput
              (keyup.enter)="buscarProductos(searchInput.value)"
            >
            <button class="search-button" (click)="buscarProductos(searchInput.value)">
              <i class="bi bi-search"></i>
            </button>
          </div>
        </div>
        <!-- Acciones de Usuario -->
        <div class="col-auto">
          <div class="d-flex align-items-center gap-3">
            <!-- Si no hay usuario -->
            @if (currentUser() === null) {
              <button class="header-btn header-btn-secondary" (click)="openLoginDialog()">
                <span class="d-none d-md-inline">Iniciar sesión</span>
                <i class="bi bi-box-arrow-in-right d-md-none"></i>
              </button>
              <button class="header-btn header-btn-primary" (click)="openRegisterDialog()">
                <span class="d-none d-md-inline">Registrarse</span>
                <i class="bi bi-person-plus d-md-none"></i>
              </button>
            }

            <!-- Si hay usuario -->
            @if (currentUser(); as user) {
              <div ngbDropdown class="user-dropdown">
                <button 
                  type="button" 
                  class="header-btn header-btn-user"
                  id="dropdownUser" 
                  ngbDropdownToggle>
                  <i class="bi bi-person-circle me-1"></i>
                  <span class="d-none d-md-inline">{{ user.nombre }}</span>
                </button>
                <div ngbDropdownMenu aria-labelledby="dropdownUser" class="dropdown-menu-end">
                  <a ngbDropdownItem routerLink="/perfil" class="dropdown-item">
                    <i class="bi bi-person-badge me-2"></i>
                    Mi Perfil
                  </a>
                  <a ngbDropdownItem routerLink="/mis-pedidos" class="dropdown-item">
                    <i class="bi bi-bag-check me-2"></i>
                    Mis Pedidos
                  </a>
                  @if (isAdmin()) {
                    <a ngbDropdownItem routerLink="/administracion" class="dropdown-item">
                      <i class="bi bi-shield-lock-fill me-2"></i>
                      Administración
                    </a>
                  }
                  <div class="dropdown-divider"></div>
                  <button ngbDropdownItem (click)="logout()" class="dropdown-item text-danger">
                    <i class="bi bi-box-arrow-right me-2"></i>
                    Cerrar Sesión
                  </button>
                </div>
              </div>
            }

            <!-- Carrito -->
            <button class="cart-btn" (click)="abrirDialogoCarrito()">
              <i class="bi bi-cart3"></i>
              @if (carritoService.totalItems() > 0) {
                <span class="cart-badge">{{ carritoService.totalItems() }}</span>
              }
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Barra de Navegación (gris claro) -->
  <nav class="header-nav">
    <div class="container-fluid">
      <div class="nav-items">
        <button class="nav-item" (click)="abrirModalCategorias()">
          <i class="bi bi-grid"></i>
          <span>Categorías</span>
        </button>
        <a class="nav-item" routerLink="/productos" routerLinkActive="active">
          <i class="bi bi-shop"></i>
          <span>Tienda</span>
        </a>
        <a class="nav-item" routerLink="/ofertas" routerLinkActive="active">
          <i class="bi bi-tag"></i>
          <span>Ofertas</span>
        </a>
        <a class="nav-item" routerLink="/productos" [queryParams]="{destacados: true}" routerLinkActive="active">
          <i class="bi bi-star"></i>
          <span>Destacados</span>
        </a>
        
        <!-- Botón móvil para menú -->
        <button class="nav-item mobile-menu-btn d-md-none ms-auto" (click)="toggleMobileMenu()">
          <i class="bi bi-list fs-4"></i>
        </button>
      </div>
    </div>
  </nav>

  <!-- Menú Móvil -->
  <div class="mobile-menu" [class.show]="showMobileMenu">
    <div class="mobile-menu-content">
      <!-- Búsqueda móvil -->
      <div class="mobile-search">
        <input 
          type="text" 
          placeholder="Buscar..." 
          class="form-control"
          #mobileSearchInput
          (keyup.enter)="buscarProductos(mobileSearchInput.value)"
        >
        <button class="btn btn-primary" (click)="buscarProductos(mobileSearchInput.value)">
          <i class="bi bi-search"></i>
        </button>
      </div>
      
      <!-- Enlaces móviles -->
      <a routerLink="/productos" class="mobile-menu-item" (click)="toggleMobileMenu()">
        <i class="bi bi-shop"></i>
        Tienda
      </a>
      <a routerLink="/ofertas" class="mobile-menu-item" (click)="toggleMobileMenu()">
        <i class="bi bi-tag"></i>
        Ofertas
      </a>
      <button class="mobile-menu-item" (click)="abrirModalCategorias()">
        <i class="bi bi-grid"></i>
        Categorías
      </button>
      
      <!-- Auth móvil -->
      @if (currentUser() === null) {
        <div class="mobile-auth">
          <button class="btn btn-outline-primary w-100 mb-2" (click)="openLoginDialog(); toggleMobileMenu()">
            Iniciar Sesión
          </button>
          <button class="btn btn-primary w-100" (click)="openRegisterDialog(); toggleMobileMenu()">
            Registrarse
          </button>
        </div>
      }
    </div>
  </div>
</header>

<!-- Modal de Categorías -->
<div *ngIf="showCategoriasModal" class="categorias-modal-overlay" (click)="cerrarModalCategorias()">
  <div class="categorias-modal" (click)="$event.stopPropagation()">
    <div class="categorias-modal-header">
      <h6 class="mb-0">
        <i class="bi bi-grid me-2"></i>
        Categorías
      </h6>
      <button class="btn-close" (click)="cerrarModalCategorias()"></button>
    </div>
    <div class="categorias-modal-body">
      @if (cargandoCategorias) {
        <div class="text-center py-4">
          <div class="spinner-border spinner-border-sm text-primary"></div>
          <p class="mt-2 small text-muted">Cargando...</p>
        </div>
      }
      @if (!cargandoCategorias && categorias.length > 0) {
        <div class="categorias-list">
          @for (categoria of categorias; track categoria.id) {
            <button class="categoria-item" (click)="navegarACategoria(categoria)">
              <i class="bi bi-tag me-2"></i>
              {{ categoria.nombre }}
              <i class="bi bi-chevron-right ms-auto"></i>
            </button>
          }
        </div>
      }
      @if (!cargandoCategorias && categorias.length === 0) {
        <div class="text-center py-4">
          <i class="bi bi-inbox fs-1 text-muted"></i>
          <p class="mt-2 text-muted">Sin categorías</p>
        </div>
      }
    </div>
    <div class="categorias-modal-footer">
      <button class="btn btn-sm btn-primary w-100" (click)="verTodasLasCategorias()">
        Ver todas las categorías
      </button>
    </div>
  </div>
</div>
