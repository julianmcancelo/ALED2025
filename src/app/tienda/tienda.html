<!-- Contenedor principal de la p√°gina de la tienda -->
<div class="container-custom py-8">

  <!-- Encabezado de la tienda -->
  <header class="text-center mb-12">
    @if (terminoBusqueda) {
      <!-- Encabezado para resultados de b√∫squeda -->
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6">
        <h1 class="text-3xl font-bold text-[#0077b6] mb-2">
          <i class="bi bi-search mr-2"></i>
          Resultados de B√∫squeda
        </h1>
        <p class="text-lg text-gray-700 mb-2">
          Buscando: <span class="font-semibold text-[#0077b6]">"{{ terminoBusqueda }}"</span>
        </p>
        <p class="text-sm text-gray-600">
          {{ totalProductos }} producto{{ totalProductos === 1 ? '' : 's' }} encontrado{{ totalProductos === 1 ? '' : 's' }}
        </p>
      </div>
    } @else {
      <!-- Encabezado normal de la tienda -->
      <h1 class="text-4xl font-bold text-gray-900 mb-4">Nuestros Productos</h1>
      <p class="text-xl text-gray-600 mb-2">Explora nuestro cat√°logo y encuentra lo que buscas.</p>
      <p class="text-sm text-gray-500">
        {{ totalProductos }} producto{{ totalProductos === 1 ? '' : 's' }} disponible{{ totalProductos === 1 ? '' : 's' }}
      </p>
    }
  </header>

  <!-- Usamos @if para manejar el estado del observable de productos -->
  @if (productos$ | async; as productos) {
    <!-- Si hay productos, los mostramos en una cuadr√≠cula -->
    @if (productos.length > 0) {
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">

        <!-- Iteramos sobre cada producto con @for -->
        @for (producto of productos; track producto.id) {
          <div class="card cursor-pointer transition-transform hover:scale-105" (click)="verDetalles(producto)">
            <!-- Imagen del producto -->
            <div class="relative aspect-w-1 aspect-h-1 w-full overflow-hidden bg-gradient-to-br from-gray-100 to-gray-200">
              @if (producto.imagen) {
                <img [src]="producto.imagen" 
                     class="w-full h-48 object-cover object-center" 
                     [alt]="producto.nombre"
                     (error)="onImageError($event)">
              } @else {
                <!-- Placeholder cuando no hay imagen -->
                <div class="w-full h-48 flex flex-col items-center justify-center bg-gradient-to-br from-blue-50 to-blue-100">
                  <i class="bi bi-box-seam text-6xl text-[#0077b6] opacity-30 mb-2"></i>
                  <span class="text-sm text-gray-500 font-medium">Sin imagen</span>
                </div>
              }
              
              <!-- Badge de categor√≠a -->
              <div class="absolute top-2 right-2">
                <span class="badge-primary">{{ producto.categoria }}</span>
              </div>
            </div>

            <!-- Cuerpo de la tarjeta con los detalles -->
            <div class="p-4">
              <h5 class="text-lg font-semibold text-gray-900 mb-2 line-clamp-2 min-h-[3.5rem]">
                {{ producto.nombre }}
              </h5>
              
              <!-- Precio destacado -->
              <div class="bg-blue-50 rounded-lg p-3 mb-3">
                <p class="text-2xl font-bold text-[#0077b6]">
                  {{ producto.precio | currency:'ARS':'symbol':'1.0-0' }}
                </p>
              </div>

              <!-- Botones de acci√≥n -->
              <div class="flex gap-2">
                <button class="flex-1 btn-primary flex items-center justify-center text-sm py-2" 
                        (click)="agregarAlCarrito(producto); $event.stopPropagation()">
                  <i class="bi bi-cart-plus-fill mr-1"></i>
                  A√±adir
                </button>
                <button class="px-3 py-2 border-2 border-[#0077b6] text-[#0077b6] rounded-lg hover:bg-blue-50 transition-colors" 
                        (click)="verDetalles(producto); $event.stopPropagation()">
                  <i class="bi bi-eye-fill"></i>
                </button>
              </div>
            </div>
          </div>
        }
      </div>
    } @else {
      <!-- Mensaje que se muestra si no hay productos -->
      <div class="text-center py-12">
        @if (terminoBusqueda) {
          <!-- Mensaje espec√≠fico para b√∫squedas sin resultados -->
          <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-8 max-w-md mx-auto">
            <i class="bi bi-search text-6xl text-yellow-500 mb-4"></i>
            <h3 class="text-2xl font-semibold text-gray-900 mb-2">Sin resultados</h3>
            <p class="text-gray-600 mb-4">
              No encontramos productos que coincidan con <span class="font-semibold">"{{ terminoBusqueda }}"</span>
            </p>
            <div class="text-sm text-gray-500">
              <p class="mb-2">üí° Sugerencias:</p>
              <ul class="text-left space-y-1">
                <li>‚Ä¢ Verifica la ortograf√≠a</li>
                <li>‚Ä¢ Usa t√©rminos m√°s generales</li>
                <li>‚Ä¢ Prueba con sin√≥nimos</li>
              </ul>
            </div>
          </div>
        } @else {
          <!-- Mensaje general cuando no hay productos -->
          <i class="bi bi-emoji-frown text-6xl text-gray-400 mb-4"></i>
          <h3 class="text-2xl font-semibold text-gray-900 mb-2">No hay productos disponibles</h3>
          <p class="text-gray-600">Vuelve a intentarlo m√°s tarde.</p>
        }
      </div>
    }
  } @else {
    <!-- Indicador de carga que se muestra mientras se obtienen los datos -->
      <div class="text-center py-12">
        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-[#0077b6]"></div>
        <p class="mt-2 text-gray-600">Cargando productos...</p>
      </div>
  }
</div>
