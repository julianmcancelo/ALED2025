<!-- Cabecera del Panel Lateral (ng-bootstrap) -->
<div class="offcanvas-header">
  <h5 class="offcanvas-title" id="offcanvas-basic-title">
    <i class="bi bi-cart3 me-2"></i>Carrito de Compras
  </h5>
  <button type="button" class="btn-close" aria-label="Close" (click)="cerrar()"></button>
</div>

<!-- Cuerpo del Panel Lateral -->
<div class="offcanvas-body">
  @if (carritoService.items().length === 0) {
  <!-- Mensaje de Carrito Vacío -->
  <div class="text-center text-muted py-5 h-100 d-flex flex-column justify-content-center">
    <i class="bi bi-cart-x" style="font-size: 3rem"></i>
    <p class="mt-3">Tu carrito de compras está vacío.</p>
  </div>
  } @else {
  <!-- Contenedor con scroll para la lista y el pie de página -->
  <div class="d-flex flex-column h-100">
    <!-- Lista de Productos (ocupa el espacio disponible) -->
    <div class="flex-grow-1" style="overflow-y: auto">
      <ul class="list-group list-group-flush">
        @for (item of carritoService.items(); track item.producto.id) {
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <div class="d-flex align-items-center">
            <img
              [src]="item.producto.imagen"
              [alt]="item.producto.nombre"
              class="rounded me-3"
              width="64"
              height="64"
              style="object-fit: cover"
            />
            <div>
              <h6 class="my-0">{{ item.producto.nombre }}</h6>
              <small class="text-muted">
                Cantidad: {{ item.cantidad }} &times; ${{ item.producto.precio }}
              </small>
            </div>
          </div>
          <div class="d-flex align-items-center">
            <span class="fw-bold me-3"> ${{ item.producto.precio * item.cantidad }} </span>
            <button
              class="btn btn-outline-danger btn-sm"
              (click)="manejarEliminar(item.producto.id)"
            >
              <i class="bi bi-trash"></i>
            </button>
          </div>
        </li>
        }
      </ul>
    </div>

    <!-- Pie de página (siempre abajo) -->
    <div class="mt-auto">
      <!-- Resumen Total -->
      <div class="d-flex justify-content-end align-items-center mt-4 pt-3 border-top">
        <span class="text-muted me-2">Total:</span>
        <span class="fw-bold fs-5 text-primary"> ${{ carritoService.totalPrecio() }} </span>
      </div>
      <!-- Botones de Acción -->
      <div class="offcanvas-footer p-3 border-top">
        <div class="d-grid gap-2">
          <button class="btn btn-primary" (click)="pagarConMercadoPago()" [disabled]="cargandoMP()">
            @if (cargandoMP()) {
            <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
            <span role="status"> Procesando...</span>
            } @else {
            <i class="bi bi-credit-card-fill me-2"></i>
            Pagar con Mercado Pago }
          </button>
          <button class="btn btn-outline-danger" (click)="manejarVaciar()">
            <i class="bi bi-trash3-fill me-2"></i>
            Vaciar Carrito
          </button>
        </div>
      </div>
    </div>
  </div>
  }
</div>
