<div class="container-fluid py-4">
  <!-- Header de Categorías -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="text-center">
        <h1 class="display-4 fw-bold text-primary mb-3">
          <i class="bi bi-grid-3x3-gap me-3"></i>Categorías
        </h1>
        <p class="lead text-muted">
          Explora nuestras categorías de productos y encuentra exactamente lo que buscas
        </p>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="cargando" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando categorías...</span>
    </div>
    <p class="mt-3 text-muted">Cargando categorías...</p>
  </div>

  <!-- Grid de Categorías -->
  <div *ngIf="!cargando" class="row g-4">
    <div 
      *ngFor="let categoria of categorias" 
      class="col-12 col-md-6 col-lg-4"
    >
      <div class="card categoria-card h-100 shadow-sm border-0">
        <!-- Imagen de la Categoría -->
        <div class="categoria-image-container">
          <img 
            [src]="obtenerImagenCategoria(categoria.id!)" 
            [alt]="categoria.nombre"
            class="card-img-top categoria-image"
            (error)="$event.target.src='assets/images/no-image.png'"
          >
          <div class="categoria-overlay">
            <div class="categoria-info">
              <i class="{{ getIconoCategoria(categoria.nombre) }} categoria-icon mb-2"></i>
              <h3 class="categoria-title">{{ categoria.nombre }}</h3>
              <p class="categoria-count">
                {{ contarProductosCategoria(categoria.id || '') }} productos disponibles
              </p>
              <div class="categoria-action">
                <span class="badge bg-light text-dark">Ver todos</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Contenido de la Categoría -->
        <div class="card-body d-flex flex-column">
          <h5 class="card-title fw-bold text-dark">
            <i class="{{ getIconoCategoria(categoria.nombre) }} me-2" [style.color]="getColorCategoria(categoria.nombre)"></i>
            {{ categoria.nombre }}
          </h5>
          
          <div class="categoria-stats mb-2">
            <span class="badge rounded-pill" [style.background-color]="getColorCategoria(categoria.nombre)">
              {{ contarProductosCategoria(categoria.id || '') }} productos
            </span>
          </div>
          
          <p class="card-text text-muted flex-grow-1">
            Descubre los mejores productos en {{ categoria.nombre }}
          </p>

          <!-- Productos Destacados -->
          <div *ngIf="obtenerProductosDestacados(categoria.id || '').length > 0" class="mb-3">
            <h6 class="text-muted mb-2">
              <i class="bi bi-star me-1"></i>Productos destacados:
            </h6>
            <div class="productos-preview-grid">
              <div 
                *ngFor="let producto of obtenerProductosDestacados(categoria.id || ''); let i = index" 
                class="producto-preview-card"
                (click)="verProducto(producto)"
              >
                <div class="producto-preview-image">
                  <img 
                    [src]="producto.imagen || 'assets/images/no-image.png'" 
                    [alt]="producto.nombre"
                    class="producto-preview-img"
                  >
                  <div class="producto-preview-overlay">
                    <button 
                      class="btn btn-sm btn-success"
                      (click)="agregarAlCarrito(producto, $event)"
                      [disabled]="estaAgregando(producto)"
                      [title]="'Agregar ' + producto.nombre + ' al carrito'"
                    >
                      <span *ngIf="estaAgregando(producto)" class="spinner-border spinner-border-sm"></span>
                      <i *ngIf="!estaAgregando(producto)" class="bi bi-cart-plus"></i>
                    </button>
                  </div>
                </div>
                <div class="producto-preview-info">
                  <div class="producto-preview-nombre">{{ producto.nombre }}</div>
                  <div class="producto-preview-precio">{{ formatearPrecio(producto.precio) }}</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Botón Ver Categoría -->
          <button 
            type="button"
            class="btn btn-primary btn-lg w-100"
            (click)="verCategoria(categoria)"
          >
            <i class="bi bi-eye me-2"></i>
            Ver Productos
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Mensaje si no hay categorías -->
  <div *ngIf="!cargando && categorias.length === 0" class="text-center py-5">
    <div class="mb-4">
      <i class="bi bi-inbox display-1 text-muted"></i>
    </div>
    <h3 class="text-muted">No hay categorías disponibles</h3>
    <p class="text-muted mb-4">Las categorías aparecerán aquí cuando estén configuradas.</p>
    
    <!-- Botones de Debug -->
    <div class="alert alert-info">
      <p class="mb-3">
        <i class="bi bi-info-circle me-2"></i>
        Si es la primera vez que usas la aplicación, puedes crear categorías de ejemplo.
      </p>
      <div class="d-grid gap-2 d-md-flex justify-content-md-center">
        <button 
          type="button" 
          class="btn btn-outline-secondary"
          (click)="probarConexionFirestore()"
        >
          <i class="bi bi-wifi me-2"></i>
          Probar Conexión
        </button>
        <button 
          type="button" 
          class="btn btn-primary"
          (click)="crearCategoriasDebug()"
        >
          <i class="bi bi-plus-circle me-2"></i>
          Crear Categorías de Ejemplo
        </button>
      </div>
    </div>
  </div>

  <!-- Sección de Navegación Rápida -->
  <div *ngIf="!cargando && categorias.length > 0" class="row mt-5">
    <div class="col-12">
      <div class="card bg-light border-0">
        <div class="card-body text-center py-4">
          <h4 class="fw-bold text-dark mb-3">
            <i class="bi bi-compass me-2"></i>
            ¿No encontrás lo que buscás?
          </h4>
          <p class="text-muted mb-4">
            Explorá todos nuestros productos o usá nuestro buscador avanzado
          </p>
          <div class="d-flex gap-3 justify-content-center flex-wrap">
            <button 
              type="button"
              class="btn btn-outline-primary btn-lg"
              (click)="router.navigate(['/productos'])"
            >
              <i class="bi bi-grid me-2"></i>
              Ver Todos los Productos
            </button>
            <button 
              type="button"
              class="btn btn-outline-secondary btn-lg"
              (click)="router.navigate(['/'])"
            >
              <i class="bi bi-house me-2"></i>
              Volver al Inicio
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
