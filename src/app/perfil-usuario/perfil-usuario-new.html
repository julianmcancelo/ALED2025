<!-- Layout estilo Mercado Libre -->
<div class="profile-layout">
  <!-- Sidebar lateral fijo -->
  <aside class="profile-sidebar">
    <div class="sidebar-header">
      <h3 class="sidebar-title">
        <i class="bi bi-person-circle me-2"></i>
        Mi cuenta
      </h3>
    </div>

    @if (currentUser(); as user) {
      <div class="user-info">
        <div class="user-avatar">
          <i class="bi bi-person-circle"></i>
        </div>
        <div class="user-details">
          <p class="user-name mb-0">{{ user.nombre }} {{ user.apellido }}</p>
          <p class="user-email mb-0 text-muted small">{{ user.email }}</p>
          <span class="badge bg-success mt-2">
            <i class="bi bi-check-circle me-1"></i>Activo
          </span>
        </div>
      </div>
    }

    <nav class="sidebar-nav">
      <a href="#datos-personales" class="nav-item active">
        <i class="bi bi-person-badge"></i>
        <span>Datos Personales</span>
      </a>
      <a href="#datos-entrega" class="nav-item">
        <i class="bi bi-truck"></i>
        <span>Datos de Entrega</span>
      </a>
      <a href="#tarjeta-virtual" class="nav-item">
        <i class="bi bi-credit-card"></i>
        <span>Tarjeta Virtual</span>
      </a>
      <a href="#historial" class="nav-item">
        <i class="bi bi-bag-check"></i>
        <span>Historial de Compras</span>
      </a>
    </nav>
  </aside>

  <!-- Contenido principal -->
  <main class="profile-main-content">
    @if (currentUser(); as user) {
      <div class="content-wrapper">
        
        <!-- Sección: Datos Personales -->
        <section id="datos-personales" class="content-section">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">
                <i class="bi bi-person-badge-fill me-2"></i>Datos Personales
              </h5>
            </div>
            <div class="card-body">
              <ul class="list-group list-group-flush">
                <li class="list-group-item"><strong>Nombre:</strong> {{ user.nombre }}</li>
                <li class="list-group-item"><strong>Apellido:</strong> {{ user.apellido }}</li>
                <li class="list-group-item"><strong>Email:</strong> {{ user.email }}</li>
                <li class="list-group-item">
                  <strong>Rol:</strong> 
                  <span class="badge bg-secondary">{{ user.rol | uppercase }}</span>
                </li>
              </ul>
            </div>
          </div>
        </section>

        <!-- Sección: Datos de Entrega -->
        <section id="datos-entrega" class="content-section">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">
                <i class="bi bi-truck me-2"></i>Datos de Entrega
              </h5>
            </div>
            <div class="card-body">
              @if (user.direccion || user.ciudad || user.codigoPostal || user.telefono) {
                <ul class="list-group list-group-flush">
                  <li class="list-group-item d-flex align-items-start">
                    <i class="bi bi-house-door text-primary me-2 mt-1"></i>
                    <div>
                      <strong>Dirección:</strong><br>
                      <span class="text-muted">{{ user.direccion || 'No especificado' }}</span>
                    </div>
                  </li>
                  <li class="list-group-item d-flex align-items-start">
                    <i class="bi bi-geo-alt text-primary me-2 mt-1"></i>
                    <div>
                      <strong>Ciudad:</strong><br>
                      <span class="text-muted">{{ user.ciudad || 'No especificado' }}</span>
                    </div>
                  </li>
                  <li class="list-group-item d-flex align-items-start">
                    <i class="bi bi-mailbox text-primary me-2 mt-1"></i>
                    <div>
                      <strong>Código Postal:</strong><br>
                      <span class="text-muted">{{ user.codigoPostal || 'No especificado' }}</span>
                    </div>
                  </li>
                  <li class="list-group-item d-flex align-items-start">
                    <i class="bi bi-telephone text-primary me-2 mt-1"></i>
                    <div>
                      <strong>Teléfono:</strong><br>
                      <span class="text-muted">{{ user.telefono || 'No especificado' }}</span>
                    </div>
                  </li>
                </ul>
                <div class="mt-3">
                  <button class="btn btn-sm btn-primary" (click)="editarDatosEnvio()">
                    <i class="bi bi-pencil-square me-1"></i> Editar Datos de Envío
                  </button>
                </div>
              } @else {
                <div class="text-center py-4">
                  <i class="bi bi-inbox text-muted" style="font-size: 3rem;"></i>
                  <p class="text-muted mt-3 mb-3">No has configurado tus datos de envío</p>
                  <button class="btn btn-primary" (click)="editarDatosEnvio()">
                    <i class="bi bi-plus-circle me-1"></i> Agregar Datos de Envío
                  </button>
                </div>
              }
            </div>
          </div>
        </section>

        <!-- Sección: Tarjeta Virtual -->
        <section id="tarjeta-virtual" class="content-section">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">
                <i class="bi bi-credit-card-2-front me-2"></i>Mi Tarjeta Virtual
              </h5>
              <small class="text-muted">Tarjeta de prueba para pagos dentro del sistema</small>
            </div>
            <div class="card-body p-0">
              <!-- Componente de tarjeta virtual -->
              <app-tarjeta-virtual 
                [usuarioId]="user.id"
                [mostrarHistorial]="false">
              </app-tarjeta-virtual>
              
              <!-- Botón para crear tarjeta si no existe -->
              <div class="p-4 border-top">
                <div class="text-center">
                  <p class="text-muted mb-3">
                    <i class="bi bi-info-circle me-1"></i>
                    ¿No ves tu tarjeta virtual arriba?
                  </p>
                  <button 
                    class="btn btn-success"
                    (click)="crearTarjetaVirtual()"
                    [disabled]="creandoTarjeta()">
                    @if (creandoTarjeta()) {
                      <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                      Creando...
                    } @else {
                      <i class="bi bi-plus-circle me-2"></i>
                      Crear Mi Tarjeta Virtual
                    }
                  </button>
                  <div class="mt-2">
                    <small class="text-muted">
                      Crea una tarjeta virtual de prueba para realizar pagos dentro del sistema
                    </small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Sección: Historial de Compras -->
        <section id="historial" class="content-section">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="card-title mb-0">
                <i class="bi bi-bag-check me-2"></i>Historial de Compras
              </h5>
              <a routerLink="/mis-pedidos" class="btn btn-outline-primary btn-sm">
                <i class="bi bi-list me-1"></i>Ver Todo
              </a>
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-4">
                  <div class="stat-box text-center p-3 bg-light rounded">
                    <i class="bi bi-check-circle text-success" style="font-size: 2rem;"></i>
                    <h6 class="mt-2 mb-0">Compras Exitosas</h6>
                    <small class="text-muted">Ver pedidos completados</small>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="stat-box text-center p-3 bg-light rounded">
                    <i class="bi bi-clock text-warning" style="font-size: 2rem;"></i>
                    <h6 class="mt-2 mb-0">Pagos Pendientes</h6>
                    <small class="text-muted">Verificar estado</small>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="stat-box text-center p-3 bg-light rounded">
                    <i class="bi bi-arrow-counterclockwise text-info" style="font-size: 2rem;"></i>
                    <h6 class="mt-2 mb-0">Reembolsos</h6>
                    <small class="text-muted">Gestionar devoluciones</small>
                  </div>
                </div>
              </div>
              
              <div class="mt-4 text-center">
                <p class="text-muted mb-3">
                  <i class="bi bi-info-circle me-2"></i>
                  Aquí puedes revisar el estado de todas tus compras y pagos
                </p>
                <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                  <a routerLink="/mis-pedidos" class="btn btn-primary">
                    <i class="bi bi-clock-history me-2"></i>Ver Historial Completo
                  </a>
                  <a routerLink="/productos" class="btn btn-outline-secondary">
                    <i class="bi bi-cart me-2"></i>Seguir Comprando
                  </a>
                </div>
              </div>
            </div>
          </div>
        </section>

      </div>
    } @else {
      <div class="content-wrapper">
        <div class="text-center py-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Cargando...</span>
          </div>
          <p class="text-muted mt-3">Cargando información del perfil...</p>
        </div>
      </div>
    }
  </main>
</div>
